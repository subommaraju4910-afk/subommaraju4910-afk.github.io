<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SquatSense AI - Full Analysis</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7fc;
    color: #333;
    text-align: center;
    padding: 2rem;
  }
  #upload-area {
    border: 2px dashed #aaa;
    padding: 3rem;
    margin-bottom: 1rem;
    cursor: pointer;
    border-radius: 12px;
    background: white;
  }
  #upload-area:hover {
    border-color: #5566cc;
  }
  #progress-bar {
    width: 80%;
    height: 12px;
    background: #ddd;
    margin: 1rem auto;
    border-radius: 6px;
    overflow: hidden;
  }
  #progress-bar-fill {
    height: 100%;
    background: #6677ff;
    width: 0%;
    transition: width 0.15s linear;
  }
  button {
    padding: 0.5rem 1.2rem;
    margin: 0.5rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  button#analyze-btn {
    background: #6677ff;
    color: white;
  }
  button#clear-btn {
    background: #444;
    color: white;
  }
  #report {
    margin-top: 2rem;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
    background: #fff;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 0 8px #ccc;
    text-align: left;
    line-height: 1.5rem;
  }
</style>
</head>
<body>

<h1>SquatSense AI</h1>
<p>Upload an image of your squat and receive form feedback.</p>

<div id="upload-area" tabindex="0">
  ⬆️ Drop photo here or click to browse
  <input type="file" id="file-input" accept="image/*" style="display:none" />
</div>

<div>
  <button id="analyze-btn" disabled>Analyze</button>
  <button id="clear-btn" disabled>Clear</button>
</div>

<div id="progress-bar">
  <div id="progress-bar-fill"></div>
</div>

<div id="report"></div>

<script>
  const uploadArea = document.getElementById('upload-area');
  const fileInput = document.getElementById('file-input');
  const analyzeBtn = document.getElementById('analyze-btn');
  const clearBtn = document.getElementById('clear-btn');
  const progressBarFill = document.getElementById('progress-bar-fill');
  const reportDiv = document.getElementById('report');

  let selectedFile = null;

  uploadArea.addEventListener('click', () => fileInput.click());
  uploadArea.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') fileInput.click();
  });

  fileInput.addEventListener('change', e => {
    if (e.target.files.length) {
      selectedFile = e.target.files[0];
      reportDiv.innerHTML = `<p>Selected file: <strong>${selectedFile.name}</strong></p>`;
      analyzeBtn.disabled = false;
      clearBtn.disabled = false;
      progressBarFill.style.width = '0%';
    }
  });

  clearBtn.addEventListener('click', () => {
    selectedFile = null;
    fileInput.value = '';
    reportDiv.innerHTML = '';
    analyzeBtn.disabled = true;
    clearBtn.disabled = true;
    progressBarFill.style.width = '0%';
  });

  analyzeBtn.addEventListener('click', () => {
    if (!selectedFile) return;
    analyzeBtn.disabled = true;
    clearBtn.disabled = true;
    reportDiv.innerHTML = `<p>Analyzing ${selectedFile.name}…</p>`;
    runProgressBar(selectedFile);
  });

  // Progress bar animation
  function runProgressBar(file) {
    let progress = 0;
    progressBarFill.style.width = "0%";

    const interval = setInterval(() => {
      progress += 2.5;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        showReport(file);
      }
      progressBarFill.style.width = progress + "%";
    }, 80);
  }

  // REAL AI BACKEND CALL
  async function showReport(file) {
    reportDiv.innerHTML = "<p>Generating detailed squat analysis…</p>";

    const base64 = await fileToBase64(file);

    try {
      const response = await fetch("http://localhost:3000/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: base64 })
      });

      const data = await response.json();

      const formatted = data.analysis
        .replace(/\n\n/g, "<br><br>")
        .replace(/\n/g, "<br>");

      reportDiv.innerHTML = `
        <h2>AI Form Analysis: ${file.name}</h2>
        <div>${formatted}</div>
        <hr>
        <p><strong>Suggestion:</strong> Try uploading different angles (side, rear, 45°) for an advanced breakdown.</p>
      `;

    } catch (err) {
      console.error(err);
      reportDiv.innerHTML = `
        <p style="color:red;"><strong>❌ ERROR:</strong> Cannot reach AI backend.</p>
        <p>Make sure your backend server is running at:<br>
        <code>http://localhost:3000/analyze</code></p>
      `;
    }
  }

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result.split(",")[1]);
      reader.onerror = reject;
    });
  }
</script>

</body>
</html>


